


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://insper.github.io/SistemasHardwareSoftware/aulas/05-funcoes/">
      
      
        <meta name="author" content="Igor Montagner">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.6">
    
    
      
        <title>05 - Funções - Sistemas Hardware-Software - 2020/2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.63b94e9e.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7f672a1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#795548">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/printing.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="brown" data-md-color-accent="amber">
  
    
      <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#05-funcoes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      











<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->

<script>
  window.site_url = "https://insper.github.io/SistemasHardwareSoftware/";
</script>

<div class="md-printing-header">
  <img class="cabecalho" src="https://insper.github.io/SistemasHardwareSoftware/css/cabecalho.png">
  <img class="logo" src="https://insper.github.io/SistemasHardwareSoftware/css/logo.png">

  <div class="frontmatter">
    <div class="materia"> Sistemas Hardware-Software </div>
    <div class="professor"> Igor Montagner </div>
    <div class="semestre"> 2020/2 </div>
  </div>
</div>

<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://insper.github.io/SistemasHardwareSoftware/"
      title="Sistemas Hardware-Software - 2020/2"
      class="md-header-nav__button md-logo"
      aria-label="Sistemas Hardware-Software - 2020/2"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Sistemas Hardware-Software - 2020/2
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              05 - Funções
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/insper/sistemashardwaresoftware/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sistemashardwaresoftware
  </div>
</a>
      </div>
    
  </nav>
</header>




    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://insper.github.io/SistemasHardwareSoftware/" title="Sistemas Hardware-Software - 2020/2" class="md-nav__button md-logo" aria-label="Sistemas Hardware-Software - 2020/2">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Sistemas Hardware-Software - 2020/2
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/insper/sistemashardwaresoftware/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sistemashardwaresoftware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../sobre/" title="Burocracias" class="md-nav__link">
      Burocracias
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Aulas
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Aulas" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Aulas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01-introducao/" title="01 e 02 - Exercícios de C" class="md-nav__link">
      01 e 02 - Exercícios de C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02-inteiros/" title="02 - Inteiros na CPU" class="md-nav__link">
      02 - Inteiros na CPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03-ram/" title="03 - Representação de dados em RAM" class="md-nav__link">
      03 - Representação de dados em RAM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04-asm-1/" title="04 - Registradores x64 e variáveis globais" class="md-nav__link">
      04 - Registradores x64 e variáveis globais
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        05 - Funções
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="05 - Funções" class="md-nav__link md-nav__link--active">
      05 - Funções
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#funcoes-e-seus-argumentos" class="md-nav__link">
    Funções e seus argumentos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exemplo-guiado" class="md-nav__link">
    Exemplo guiado
  </a>
  
    <nav class="md-nav" aria-label="Exemplo guiado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assinatura-da-funcao" class="md-nav__link">
    Assinatura da função
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#o-codigo" class="md-nav__link">
    O código
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pratica" class="md-nav__link">
    Prática
  </a>
  
    <nav class="md-nav" aria-label="Prática">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arquivo-ex1o" class="md-nav__link">
    Arquivo ex1.o
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex2o" class="md-nav__link">
    Arquivo ex2.o
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex3o" class="md-nav__link">
    Arquivo ex3.o
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex4" class="md-nav__link">
    Arquivo ex4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex5-desafio" class="md-nav__link">
    Arquivo ex5 (desafio)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06-condicionais/" title="06 - Condicionais" class="md-nav__link">
      06 - Condicionais
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../07-loops/" title="07 - Loops" class="md-nav__link">
      07 - Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../08-variaveis-locais/" title="08 - Variáveis locais" class="md-nav__link">
      08 - Variáveis locais
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../09-arrays/" title="09 - Array em Assembly" class="md-nav__link">
      09 - Array em Assembly
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10-malloc/" title="10 - Alocação Dinâmica de Memória" class="md-nav__link">
      10 - Alocação Dinâmica de Memória
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../11-tipos-de-dados/" title="11 - Tipos abstratos de dados" class="md-nav__link">
      11 - Tipos abstratos de dados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../12-linux-do-zero/" title="12 - Linux do Zero" class="md-nav__link">
      12 - Linux do Zero
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../13-entrada-saida/" title="13 - Entrada/Saída" class="md-nav__link">
      13 - Entrada/Saída
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../14-processos/" title="14 - Processos" class="md-nav__link">
      14 - Processos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../15-exec/" title="15 - Carregamento de programas" class="md-nav__link">
      15 - Carregamento de programas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../99-corretor-automatico/" title="99 - Corretor Automático" class="md-nav__link">
      99 - Corretor Automático
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Projetos
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Projetos" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Projetos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projetos/bomblab/" title="Bomb Lab" class="md-nav__link">
      Bomb Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projetos/posix/" title="Linux do Zero" class="md-nav__link">
      Linux do Zero
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#funcoes-e-seus-argumentos" class="md-nav__link">
    Funções e seus argumentos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exemplo-guiado" class="md-nav__link">
    Exemplo guiado
  </a>
  
    <nav class="md-nav" aria-label="Exemplo guiado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assinatura-da-funcao" class="md-nav__link">
    Assinatura da função
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#o-codigo" class="md-nav__link">
    O código
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pratica" class="md-nav__link">
    Prática
  </a>
  
    <nav class="md-nav" aria-label="Prática">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arquivo-ex1o" class="md-nav__link">
    Arquivo ex1.o
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex2o" class="md-nav__link">
    Arquivo ex2.o
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex3o" class="md-nav__link">
    Arquivo ex3.o
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex4" class="md-nav__link">
    Arquivo ex4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquivo-ex5-desafio" class="md-nav__link">
    Arquivo ex5 (desafio)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/insper/sistemashardwaresoftware/edit/master/docs/aulas/05-funcoes/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="05-funcoes">05 - Funções<a class="headerlink" href="#05-funcoes" title="Permanent link">&para;</a></h1>
<!-- TOOD: ano que vem esse precisa de um exercício com correção automatizada. -->

<p>Neste handout vamos trabalhar pela primeira vez na tradução reversa de programas em Assembly para <em>C</em>. Nas últimas aulas vimos as instruções <code>mov</code> e <code>add</code> e na aula de hoje vimos uma tabela grande com as instruções aritméticas (<code>add</code>, <code>sub</code>, <code>mul</code>, <code>imul</code>, <code>div</code>, etc). </p>
<p>Como em todas as aulas, veremos hoje um detalhe a mais sobre arquitetura <em>x64</em>: chamadas de funções e argumentos.</p>
<h2 id="funcoes-e-seus-argumentos">Funções e seus argumentos<a class="headerlink" href="#funcoes-e-seus-argumentos" title="Permanent link">&para;</a></h2>
<p>Em <em>x64</em> os argumentos das funções são passados nos registradores e o valor de retorno é colocado também em um registrador. </p>
<ol>
<li><strong>Argumentos inteiros ou ponteiros</strong> são passados nos registradores <code>%rdi</code>, <code>%rsi</code>, <code>%rdx</code>, <code>%rcx</code>, <code>%r8</code> e <code>%r9</code> (<strong>nesta ordem</strong>).</li>
<li><strong>Argumentos ponto flutuante</strong> são passados nos registradores <code>%xmm0</code> até <code>%xmm7</code>.</li>
<li><strong>Valores de retorno inteiros ou ponteiros</strong> são colocados no registrador <code>%rax</code>.</li>
<li><strong>Valores de retorno ponto flutuante</strong> são colocados no registrador <code>%xmm0</code>. </li>
</ol>
<p>Para chamar funções usamos a instrução <code>call</code> seguido do endereço de memória da função. O <code>gdb</code> cria um "apelido" para estes endereços de memória usando o nome original da função no arquivo <em>.c</em>. Assim, estas instruções são mostradas, normalmente, como <code>call func1</code>, por exemplo. Note que antes de cada <code>call</code> devemos preencher os argumentos nos registradores corretos. </p>
<p>Para retornar usamos a instrução <code>ret</code>. Ela é equivalente ao comando <code>return</code> de <em>C</em> e devolverá o valor armazenado no <code>%rax</code> (ou <code>%xmm0</code> para ponto flutuante). </p>
<p><img alt="Registradores de 64 e 32 bits" src="registradores-grandes.png" /></p>
<p><img alt="Registradores de 32, 16 e 8 bits" src="registradores-pequenos.png" /></p>
<p>Não se esqueça da equivalência entre o tamanhos dos registradores e os tipos inteiros em <em>C</em>. Um resumo gráfico pode ser visto nas figuras acima.</p>
<ol>
<li>64 bits (<code>%rax</code>, <code>%rdi</code> e outros que começam com <code>r</code>): (<code>unsigned</code>) <code>long</code> ou ponteiro;</li>
<li>32 bits (<code>%eax</code>, <code>%edi</code> e outros que começa com <code>e</code> e os que terminam em <code>d</code> como <code>r10d</code>): <code>int</code> ou <code>unsigned int</code>;</li>
<li>16 bits (<code>%ax</code>, <code>%di</code> e outros com duas letras somente terminando em <code>x</code>): <code>short</code> ou <code>unsigned short</code></li>
<li>8 bits (<code>%al</code>, <code>%ah</code> e outros com duas letras terminando em <code>h</code> ou <code>l</code>): <code>char</code> ou <code>unsigned char</code>.</li>
</ol>
<p>Vamos agora praticar fazendo a tradução de funções que fazem aritmética simples entre inteiros (usando ou não ponteiros). O exemplo abaixo mostra todas as etapas que precisamos seguir para fazer a tradução Assembly -&gt; C.</p>
<h2 id="exemplo-guiado">Exemplo guiado<a class="headerlink" href="#exemplo-guiado" title="Permanent link">&para;</a></h2>
<p>Dado o código Assembly abaixo, faça sua tradução para <em>C</em></p>
<div class="highlight"><pre><span></span><code>0000000000000000 &lt;misterio1&gt;:
0:   48 01 f7                add    %rsi,%rdi
3:   48 8d 04 57             lea    (%rdi,%rdx,2),%rax
7:   c3                      retq
</code></pre></div>
<h3 id="assinatura-da-funcao">Assinatura da função<a class="headerlink" href="#assinatura-da-funcao" title="Permanent link">&para;</a></h3>
<p>Vamos começar pela assinatura da função. É sempre útil identificar quais registradores são lidos antes de serem escritos. Isso nos ajuda a entender se um registrador é um argumento da função ou se ele é apenas usado como variável local. Faremos isso escrevendo todos os registradores que podem ser argumentos em ordem e vendo se são lidos ou escritos primeiro:</p>
<ul>
<li><code>%rdi</code> - lido primeiro (<code>add</code> faz a operação <code>+=</code>)</li>
<li><code>%rsi</code> - lido primeiro (no lado esquerdo do <code>add</code>)</li>
<li><code>%rdx</code> - lido primeiro (no lado esquerdo do <code>lea</code>)</li>
<li><code>%rcx</code> - não usado</li>
<li><code>%r8</code> - não usado</li>
<li><code>%r9</code> - não usado</li>
</ul>
<p>Logo, os registradores <code>%rdi</code>, <code>%rsi</code> e <code>%rdx</code> são argumentos da função. Consultando o box de arquitetura de computadores, vemos que a função recebe três argumentos do tipo <code>long</code> (pois usa os registradores de 64 bits). </p>
<p>Note que o resultado das computações é guardado em <code>%rax</code>, que guarda sempre o retorno da função. Por usar a porção de 64 bits do registrador, o tipo de retorno também é <code>long</code>. A assinatura da função é, portanto</p>
<p><code>long misterio1(long a, long b, long c);</code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ponteiros também usam os registradores de 64 bits. Porém, olhando rapidamente o código notamos que não há nenhum acesso a memória. Logo, se trata realmente de <code>long</code>.</p>
</div>
<h3 id="o-codigo">O código<a class="headerlink" href="#o-codigo" title="Permanent link">&para;</a></h3>
<p>Vamos agora para o código. Nossa primeira estratégia é atribuir um nome para cada registrador. Os três registradores de argumentos já receberam os nomes <code>a</code>, <code>b</code> e <code>c</code>. Para deixar explícito o papel do <code>%rax</code> vamos nomeá-lo de <code>retval</code>. </p>
<p>A primeira instrução <code>add %rsi, %rdi</code> realiza a adição dos dois registradores e armazena em <code>%rdi</code>. Logo, sua tradução direta seria:</p>
<div class="highlight"><pre><span></span><code><span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span>
</code></pre></div>
<p>A instrução <code>lea (%rdi, %rdx, 2), %rax</code> é usada tanto para calcular endereços de memória quanto para aritmética simples. Vemos que é o segundo caso pois, no código seguinte, não acessamos a memória com o valor calculado. Logo, podemos traduzir este trecho como</p>
<div class="highlight"><pre><span></span><code><span class="n">retval</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>
</code></pre></div>
<p>Logo após temos o <code>ret</code>, que é traduzido como</p>
<div class="highlight"><pre><span></span><code><span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
</code></pre></div>
<p>Logo, nossa função é traduzida como </p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span> <span class="nf">misterio1</span><span class="p">(</span><span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">,</span> <span class="kt">long</span> <span class="n">c</span><span class="p">){</span> 
    <span class="kt">long</span> <span class="n">retval</span><span class="p">;</span>
    <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Finalmente, podemos deixar nosso código legível e escrevê-lo como</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span> <span class="nf">misterio1</span><span class="p">(</span><span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="n">b</span><span class="p">,</span> <span class="kt">long</span> <span class="n">c</span><span class="p">){</span> 
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Você pode verificar o código original no arquivo <code>exemplo1.c</code>. </p>
<hr />
<p>O processo acima pode ser formalizado no seguinte algoritmo:</p>
<ol>
<li>Identifique quantos argumentos a função recebe</li>
<li>Identifique os tipos de cada argumento (pode ser necessário olhar o código assembly da função)</li>
<li>Dê um nome para cada registrador. Se um mesmo registrador é usado com tamanhos diferentes (<code>%rdi</code> e <code>%edi</code> são usados no código), dê um nome diferente para cada tamanho.</li>
<li>Faça a tradução de cada instrução separadamente.</li>
<li>Fique atento aos valores colocados em <code>%rax</code> e <code>%eax</code> perto do fim do código. Esses valores serão retornados pela função.</li>
<li>O código gerado costuma ser ilegível. Refatore-o para melhorar sua legibilidade. </li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>A instrução <code>lea</code> pode ser usada tanto para aritmética quanto para cálculo de endereços. Para tirar a dúvida basta olhar se as próximas instruções fazem acesso à memória com o endereço calculado ou apenas usam o valor diretamente (aritmética).</li>
<li>Os registradores de tamanhos menores são virtuais. Quanto escrevo em <code>%ax</code> estou escrevendo nos 16 bits menos significativos de <code>%rax</code> e de <code>%eax</code> também. </li>
<li>Muitas instruções com operadores de 32bits zeram os 32bits superiores. Assim, vemos por exemplo a instrução <code>mov $0, %eax</code> sendo usada para zerar um <code>long</code>. Nesses casos é necessário verificar se a função continua usando <code>%eax</code> (é <code>int</code> mesmo) ou se ela magicamente passa a usar <code>%rax</code> (o tipo era <code>long</code>).</li>
</ul>
</div>
<h2 id="pratica">Prática<a class="headerlink" href="#pratica" title="Permanent link">&para;</a></h2>
<p>Vamos agora exercitar. Cada exercício faz um cálculo diferente. Se houver alguma instrução desconhecida, pesquise-a no google para encontrar seu significado. Normalmente algo como "asm x64 instruction" + a instrução desconhecida dá respostas corretas.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Usaremos o <code>gdb</code> para abrir os arquivos <code>.o</code> nesta aula. Este tipo de arquivo contém funções compiladas, mas não é um executável completo por não ter uma função <code>main</code>. </p>
</div>
<h3 id="arquivo-ex1o">Arquivo <em>ex1.o</em><a class="headerlink" href="#arquivo-ex1o" title="Permanent link">&para;</a></h3>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>O código abaixo foi retirado do arquivo <code>ex1.o</code>. Faça sua tradução para <em>C</em>.</p>
<div class="highlight"><pre><span></span><code>0000000000000000 &lt;ex1&gt;:
0:   89 f8                   mov    %edi,%eax
2:   29 f0                   sub    %esi,%eax
4:   c3                      retq
</code></pre></div>
</div>
<h3 id="arquivo-ex2o">Arquivo <em>ex2.o</em><a class="headerlink" href="#arquivo-ex2o" title="Permanent link">&para;</a></h3>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Use o <code>gdb</code> para listar as funções definidas em <code>ex2.o</code> e escreva-as abaixo.</p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Faça a tradução das funções acima para <em>C</em></p>
</div>
<h3 id="arquivo-ex3o">Arquivo <em>ex3.o</em><a class="headerlink" href="#arquivo-ex3o" title="Permanent link">&para;</a></h3>
<p>A função abaixo foi obtida de <code>ex3.o</code>.  </p>
<div class="highlight"><pre><span></span><code>0000000000000000 &lt;ex3&gt;:
0:   8b 06                   mov    (%rsi),%eax
2:   0f af c0                imul   %eax,%eax
5:   89 07                   mov    %eax,(%rdi)
7:   c3                      retq
</code></pre></div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>O quê faz a instrução <code>imul</code>?</p>
</div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Traduza esta função para <em>C</em>. Fique atento ao tamanho dos registradores usados para identificar o tamanho dos variáveis inteiras.</p>
</div>
<hr />
<p>Antes de prosseguir, valide suas soluções da seção anterior com o professor.</p>
<p>Vamos agora trabalhar com executáveis "completos". Vamos analisar não somente o código das funções mas também sua chamada.</p>
<h3 id="arquivo-ex4">Arquivo <em>ex4</em><a class="headerlink" href="#arquivo-ex4" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Use o <code>gdb</code> para obter o conteúdo das funções <code>main</code> e <code>ex4</code>.</p>
<p><strong>Dica</strong>: lembre-se do comando <code>disas</code></p>
</div>
<p>Localize a chamada da função <code>ex4</code> no main. As intruções acima do <code>call</code> colocam os argumentos nos lugares corretos para <code>ex4</code> rodar. </p>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Quantos argumentos a função recebe? Quais são seus valores?</p>
</div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Traduza a função <code>ex4</code> para <em>C</em>.</p>
</div>
<h3 id="arquivo-ex5-desafio">Arquivo <em>ex5</em> (desafio)<a class="headerlink" href="#arquivo-ex5-desafio" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Este exercício é avançado e necessita de pesquisa para ser realizado. Faça-o somente após validar suas soluções dos anteriores com os professores.</p>
</div>
<p>Neste exercício vamos nos aprofundar no uso de ponteiros. Vimos no <em>ex3.o</em> um exemplo de função que armazenava um valor calculado em um ponteiro. Agora veremos um exemplo completo que inclui a chamada de uma função recebendo um endereço.</p>
<p>O trecho abaixo copia os argumentos para os registradores corretos e chama a função.</p>
<div class="highlight"><pre><span></span><code>60b:   48 8d 4c 24 08          lea    0x8(%rsp),%rcx
610:   48 8d 54 24 0c          lea    0xc(%rsp),%rdx
615:   be 03 00 00 00          mov    $0x3,%esi
61a:   bf 0a 00 00 00          mov    $0xa,%edi
61f:   e8 d6 ff ff ff          callq  5fa &lt;ex5&gt;
</code></pre></div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Identifique a partir dos tipos de dados colocados nos registradores qual o tipo dos argumentos da função.</p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Qual são os endereços passados para a função <code>ex5</code>? Escreva-os em função do registrador <code>%rsp</code>. </p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Os endereços acima são passados em quais registradores? </p>
</div>
<p>Vamos agora ao código de <code>ex5</code>:</p>
<div class="highlight"><pre><span></span><code>00000000000005fa &lt;ex5&gt;:
5fa:   89 f8                   mov    %edi,%eax
5fc:   48 89 d7                mov    %rdx,%rdi
5ff:   99                      cltd
600:   f7 fe                   idiv   %esi
602:   89 07                   mov    %eax,(%rdi)
604:   89 11                   mov    %edx,(%rcx)
606:   c3                      retq
</code></pre></div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Como a instrução <code>idiv</code> funciona? Em quais registradores ela posiciona seu resultado? Em quais registradores ela espera a entrada?</p>
</div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>O quê faz a instrução <code>cltd</code>? Por quê ela é necessária?</p>
</div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Faça a tradução de <code>ex5</code> para <em>C</em>.</p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../04-asm-1/" title="04 - Registradores x64 e variáveis globais" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                04 - Registradores x64 e variáveis globais
              </div>
            </div>
          </a>
        
        
          <a href="../06-condicionais/" title="06 - Condicionais" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                06 - Condicionais
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../../translate-admonitions.js"></script>
      
    
  </body>
</html>