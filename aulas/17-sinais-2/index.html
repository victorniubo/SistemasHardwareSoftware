


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://insper.github.io/SistemasHardwareSoftware/aulas/17-sinais-2/">
      
      
        <meta name="author" content="Igor Montagner">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>17 - Capturando sinais - Sistemas Hardware-Software - 2020/2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4dd2dd8d.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.6a5ad368.min.css">
      
      
        
        
        <meta name="theme-color" content="#795649">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/printing.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="brown" data-md-color-accent="amber">
  
    
      <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#17-capturando-sinais" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      











<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->

<script>
  window.site_url = "https://insper.github.io/SistemasHardwareSoftware/";
</script>

<div class="md-printing-header">
  <img class="cabecalho" src="https://insper.github.io/SistemasHardwareSoftware/css/cabecalho.png">
  <img class="logo" src="https://insper.github.io/SistemasHardwareSoftware/css/logo.png">

  <div class="frontmatter">
    <div class="materia"> Sistemas Hardware-Software </div>
    <div class="professor"> Igor Montagner </div>
    <div class="semestre"> 2020/2 </div>
  </div>
</div>

<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="https://insper.github.io/SistemasHardwareSoftware/"
      title="Sistemas Hardware-Software - 2020/2"
      class="md-header-nav__button md-logo"
      aria-label="Sistemas Hardware-Software - 2020/2"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Sistemas Hardware-Software - 2020/2
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              17 - Capturando sinais
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository containing source -->
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/insper/sistemashardwaresoftware/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sistemashardwaresoftware
  </div>
</a>
      </div>
    
  </nav>
</header>




    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://insper.github.io/SistemasHardwareSoftware/" title="Sistemas Hardware-Software - 2020/2" class="md-nav__button md-logo" aria-label="Sistemas Hardware-Software - 2020/2">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Sistemas Hardware-Software - 2020/2
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/insper/sistemashardwaresoftware/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    sistemashardwaresoftware
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../sobre/" title="Burocracias" class="md-nav__link">
      Burocracias
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Aulas
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Aulas" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Aulas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01-introducao/" title="01 e 02 - Exercícios de C" class="md-nav__link">
      01 e 02 - Exercícios de C
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02-inteiros/" title="02 - Inteiros na CPU" class="md-nav__link">
      02 - Inteiros na CPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03-ram/" title="03 - Representação de dados em RAM" class="md-nav__link">
      03 - Representação de dados em RAM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04-asm-1/" title="04 - Registradores x64 e variáveis globais" class="md-nav__link">
      04 - Registradores x64 e variáveis globais
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../05-funcoes/" title="05 - Funções" class="md-nav__link">
      05 - Funções
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06-condicionais/" title="06 - Condicionais" class="md-nav__link">
      06 - Condicionais
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../07-loops/" title="07 - Loops" class="md-nav__link">
      07 - Loops
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../08-variaveis-locais/" title="08 - Variáveis locais" class="md-nav__link">
      08 - Variáveis locais
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../09-arrays/" title="09 - Array em Assembly" class="md-nav__link">
      09 - Array em Assembly
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10-malloc/" title="10 - Alocação Dinâmica de Memória" class="md-nav__link">
      10 - Alocação Dinâmica de Memória
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../11-tipos-de-dados/" title="11 - Tipos abstratos de dados" class="md-nav__link">
      11 - Tipos abstratos de dados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../12-linux-do-zero/" title="12 - Linux do Zero" class="md-nav__link">
      12 - Linux do Zero
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../13-entrada-saida/" title="13 - Entrada/Saída" class="md-nav__link">
      13 - Entrada/Saída
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../14-processos/" title="14 - Processos" class="md-nav__link">
      14 - Processos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../15-exec/" title="15 - Carregamento de programas" class="md-nav__link">
      15 - Carregamento de programas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../16-sinais-1/" title="16 - Sinais 1" class="md-nav__link">
      16 - Sinais 1
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        17 - Capturando sinais
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="17 - Capturando sinais" class="md-nav__link md-nav__link--active">
      17 - Capturando sinais
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#capturando-sinais-a-chamada-sigaction" class="md-nav__link">
    Capturando sinais - a chamada sigaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sinais-e-concorrencia" class="md-nav__link">
    Sinais e concorrência
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bloqueio-de-sinais" class="md-nav__link">
    Bloqueio de sinais
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../18-threads/" title="18 - Concorrência e Threads" class="md-nav__link">
      18 - Concorrência e Threads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../19-sincronizacao/" title="19 - Sincronização" class="md-nav__link">
      19 - Sincronização
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../99-corretor-automatico/" title="99 - Corretor Automático" class="md-nav__link">
      99 - Corretor Automático
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Projetos
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Projetos" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Projetos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../projetos/bomblab/" title="Bomb Lab" class="md-nav__link">
      Bomb Lab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../projetos/posix/" title="Linux do Zero" class="md-nav__link">
      Linux do Zero
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#capturando-sinais-a-chamada-sigaction" class="md-nav__link">
    Capturando sinais - a chamada sigaction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sinais-e-concorrencia" class="md-nav__link">
    Sinais e concorrência
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bloqueio-de-sinais" class="md-nav__link">
    Bloqueio de sinais
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/insper/sistemashardwaresoftware/edit/master/docs/aulas/17-sinais-2/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="17-capturando-sinais">17 - Capturando sinais<a class="headerlink" href="#17-capturando-sinais" title="Permanent link">&para;</a></h1>
<p>Na aula de hoje iremos criar programas que <em>reagem</em> a sinais recebidos. Já vimos que o sistema tem uma série de comportamentos padrão para cada sinal, então hoje aprenderemos a customizar esse comportamento.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Apesar de muitos recursos mostrarem o uso da chamada <code>signal</code> para a
captura de sinais, ela é considerada obsoleta e o recomendado é usar
<code>sigaction</code>, que é um pouco mais complicada de usar mas permite maior flexibilidade ao definir o comportamento do processo.</p>
</div>
<h2 id="capturando-sinais-a-chamada-sigaction">Capturando sinais - a chamada <code>sigaction</code><a class="headerlink" href="#capturando-sinais-a-chamada-sigaction" title="Permanent link">&para;</a></h2>
<p>O exemplo abaixo cria um <code>struct sigaction</code> e o seta para executar um handler quando o processo receber <code>SIGINT</code> (Ctrl+C).</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">sig_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// faz algo aqui</span>
<span class="p">}</span>

<span class="p">....</span>
<span class="k">struct</span> <span class="n">sigaction</span> <span class="n">s</span><span class="p">;</span>
<span class="n">s</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="n">sig_handler</span><span class="p">;</span> <span class="c1">// aqui vai a função a ser executada</span>
<span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
<span class="n">s</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">sigaction</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Usando como exemplo o código acima, modifique o arquivo <em>sinal1.c</em> para que o programa só termine após apertar Ctrl+C três vezes. Você pode usar <code>exit</code> para sair na terceira vez. Não se esqueça de consultar <code>man sigaction</code> para verificar quais <code>include</code>s deve ser usados.</p>
</div>
<p>O programa acima funciona, mas seu término não é condizente com a ação do usuário. Ao sair com <code>exit</code> o processo pai (no caso o shell) não consegue saber que o programa foi interrompido pelo usuário e acha que ele terminou normalmente. Podemos resetar o comportamento padrão de um sinal atribuindo a constante <code>SIG_DFL</code> (<em>signal default</em>) a <code>sigaction.sa_handler</code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Restaure o comportamento original no segundo <em>Ctrl+C</em>, fazendo com que o processo realmente termine com o sinal.</p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Podemos verificar o sinal que terminou um processo usando o comando <code>kill -l "$?"</code>. Execute-o e veja que realmente é <code>SIGINT</code>.</p>
</div>
<h2 id="sinais-e-concorrencia">Sinais e concorrência<a class="headerlink" href="#sinais-e-concorrencia" title="Permanent link">&para;</a></h2>
<p>Nesta parte vamos trabalhar com o arquivo <code>sinais-concorrentes.c</code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Leia o conteúdo do arquivo acima e complete as partes faltantes.</p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Teste sua implementação enviando sinais <code>SIGINT</code>e <code>SIGTERM</code> para seu processo. Os resultados foram os esperados?</p>
</div>
<p>Vamos agora examinar o que acontece quando trabalhamos com vários sinais sendo recebidos ao mesmo tempo.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Abra dois terminais. No primeiro execute <code>sinais-concorrentes</code>.</p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>No segundo terminal, realize a seguinte sequência de comandos. Para cada comando, anote o que é mostrado no terminal.</p>
<ol>
<li>Envie o sinal SIGINT para o programa.</li>
<li>Envie o sinal SIGTERM para o programa.</li>
<li>Envie de novo SIGINT.</li>
</ol>
</div>
<div class="admonition question medium">
<p class="admonition-title">Question</p>
<p>Assumindo que cada função roda do começo ao fim sem interrupçãom, os valores da variável <code>status</code> foram os esperados? Se não, como você explica o ocorrido?</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Valide sua resposta com o professor antes de prosseguir. Se quiser, poderá esperar pela correção do exercício.</p>
</div>
<h2 id="bloqueio-de-sinais">Bloqueio de sinais<a class="headerlink" href="#bloqueio-de-sinais" title="Permanent link">&para;</a></h2>
<p>A principal vantagem de usarmos <code>sigaction</code> é que esta chamada permite configurar sinais a serem <strong>bloqueados</strong> durante a execução da função <code>sa_handler</code>. Ou seja, se um sinal bloqueado for recebido durante sua execução ele é colocado "em espera" até que <code>sa_handler</code> acabe de rodar!</p>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>Bloquear sinais evita o problema detectado na parte anterior?</p>
</div>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Quais sinais deverão ser bloqueados durante a execução do handler <code>SIGINT</code>? E durante a execução do handler <code>SIGTERM</code>?</p>
</div>
<div class="admonition question short">
<p class="admonition-title">Question</p>
<p>O campo <code>sa_mask</code> permite bloquear sinais enquanto os handlers executam. Consulte <code>man sigsetops</code> para ver como preenchê-lo. Escreva abaixo os comandos para tal.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Modifique <code>sinais-concorrentes.c</code> para que <em>SIGTERM</em> seja bloqueado enquanto o handler de <em>SIGINT</em> roda. Repita então o experiemento acima e veja que não há mais conflito na variável global compartilhada.</p>
</div>
<p>!!! example O que fizemos não permite que <code>SIGINT</code> seja interrompido por um <code>SIGTERM</code>, mas permite que um <code>SIGTERM</code> seja interrompido por um <code>SIGINT</code>! Corrija esta situação.</p>
<!--
# Exercícios para praticar

**Exercício:** Modifique `sinal1.c` para que, ao ser colocado em background usando
Ctrl+Z (SIGTSTP), imprima uma mensagem antes de parar de executar.

**Dicas**:

* Você precisa retornar o comportamento padrão do sinal depois de dar o print.
* Pesquise como usar `raise` para (re)enviar um sinal para o próprio processo.

**Exercício**: Complete o programa acima com uma outra função que imprime a mensagem *Continuando!* quando o programa voltar a rodar (sinal `SIGCONT`).

----

Uma parte importante de sinais em sistemas POSIX é que, ao interromper um processo, eles podem cancelar operações que estavam ocorrendo. Em especial, chamadas de sistema que deixam um processo bloqueado (como `wait` e `sleep`) ou que fazem operações de entrada/saída (como `read` e `write`).

**Exercício**: compile e rode o programa `sleep_longo.c`. O quê foi mostrado na tela?

**Exercício**: Rode novamente o programa. Abra um novo terminal e envie um sinal `SIGTERM` para este processo. O quê é mostrado na tela? Você consegue interpretar este resultado?

**Exercício**: Como checamos que `sleep` realmente parou o processo por todo o tempo?

**Exercício**: Modifique o programa para que ele chame `sleep` tanto quanto for necessário para que o processo durma o tempo especificado. Salve este arquivo como `sleep_longo_while.c`.

**Exercício**: Troque o código de `sleep_longo.c` para ignorar o sinal `SIGTERM`. O programa agora funciona como esperado? Por que?
-->
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../16-sinais-1/" title="16 - Sinais 1" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                16 - Sinais 1
              </div>
            </div>
          </a>
        
        
          <a href="../18-threads/" title="18 - Concorrência e Threads" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                18 - Concorrência e Threads
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
      
        <script src="../../translate-admonitions.js"></script>
      
    
  </body>
</html>